apply plugin: 'java'
apply plugin: 'idea'

version = "1.0-SNAPSHOT"
libsDirName = '../prototype'

tasks.withType(JavaCompile) {
	options.encoding = 'UTF-8'
}

subprojects {
    apply plugin: 'java'
    apply plugin: 'idea'

    sourceCompatibility = 1.8
    targetCompatibility = 1.8

    libsDirName = '../../../prototype/service'

    sourceSets {
        main {
            java {
                srcDir 'main/'
            }
        }
        test {
            java {
                srcDir 'test/java'
            }
        }
    }

    repositories {
        maven { url 'http://repo.maven.apache.org/maven2' }
    }

    test {
        testLogging {
            events "failed"
            exceptionFormat "short"
        }
    }
}

repositories {
    maven { url 'http://repo.maven.apache.org/maven2' }
}

jar {
    from {
        (configurations.runtime).collect {
            it.isDirectory() ? it : zipTree(it)
        }
    }
    manifest {
        attributes 'Implementation-Title' : 'chili-core',
                'Implementation-Version': version,
                'Main-Class': 'com.codingchili.core.Launcher'
    }
}

subprojects.each { subproject -> evaluationDependsOn( subproject.path ) }

jar.dependsOn subprojects.tasks['classes']
jar {
    baseName = 'core-full'
    manifest {
        attributes 'Main-Class': 'com.codingchili.core.Launcher'
    }
    subprojects.each { subproject ->
        from subproject.sourceSets.main.output.classesDir
        from subproject.sourceSets.main.output.resourcesDir
    }
}

allprojects {
    dependencies {

    }
}