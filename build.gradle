apply plugin: 'java'

version = "1.0-SNAPSHOT"
libsDirName = '../output'

tasks.withType(JavaCompile) {
	options.encoding = 'UTF-8'
}

subprojects {
    apply plugin: 'java'

    sourceCompatibility = 1.8
    targetCompatibility = 1.8

    libsDirName = '../../output/service'

    repositories {
        maven { url 'http://repo.maven.apache.org/maven2' }
    }
}

repositories {
    maven { url 'http://repo.maven.apache.org/maven2' }
}

jar {
    from {
        (configurations.runtime).collect {
            it.isDirectory() ? it : zipTree(it)
        }
    }
    manifest {
        attributes 'Implementation-Title' : 'chili-core',
                'Implementation-Version': version,
                'Main-Class': 'com.codingchili.core.Launcher'
    }
}

subprojects.each { subproject -> evaluationDependsOn( subproject.path ) }

jar.dependsOn subprojects.tasks['classes']
jar {
    baseName = 'core-packed'
    manifest {
        attributes 'Main-Class': 'com.codingchili.core.Launcher'
    }
    subprojects.each { subproject ->
        from subproject.sourceSets.main.output.classesDir
        from subproject.sourceSets.main.output.resourcesDir
    }
}

allprojects {
    dependencies {
        compile group: 'junit', name: 'junit', version: '4.12'
        compile group: 'io.vertx', name: 'vertx-core', version: '3.3.3'
        compile group: 'io.vertx', name: 'vertx-unit', version: '3.3.3'
        compile group: 'io.vertx', name: 'vertx-web', version: '3.3.3'
        compile group: 'io.vertx', name: 'vertx-hazelcast', version: '3.3.3'
        compile group: 'io.vertx', name: 'vertx-mongo-client', version: '3.3.3'
        compile group: 'io.vertx', name: 'vertx-dropwizard-metrics', version: '3.3.3'
        compile group: 'org.fusesource.jansi', name: 'jansi', version: '1.14'

        // the following dependencies are about 25MB in size..
        compile group: 'org.elasticsearch.client', name: 'transport', version: '5.0.2'
    }
}